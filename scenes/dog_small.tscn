[gd_scene load_steps=22 format=3 uid="uid://dyugdxrsv73ma"]

[ext_resource type="PackedScene" uid="uid://16ptmfjmso7r" path="res://assets/models/dogsmall.glb" id="1_jbm7t"]
[ext_resource type="Script" uid="uid://yvlgjjkmf4r4" path="res://scripts/entity.gd" id="1_vt3n5"]
[ext_resource type="Resource" uid="uid://cad150pbfw3ck" path="res://resources/enemies/dog_small.tres" id="2_7ggby"]
[ext_resource type="PackedScene" uid="uid://dis5xffdkf7e6" path="res://scenes/components/enemy_behaviour_component.tscn" id="2_b80u5"]
[ext_resource type="PackedScene" uid="uid://dj6fmag6n8s5m" path="res://scenes/components/activate_damage_area.tscn" id="4_oun8b"]
[ext_resource type="PackedScene" uid="uid://dyriga41qx3tc" path="res://scenes/health_bar.tscn" id="6_j1ijx"]

[sub_resource type="BoxShape3D" id="BoxShape3D_7ggby"]
size = Vector3(0.187012, 0.218994, 0.143066)

[sub_resource type="CapsuleShape3D" id="CapsuleShape3D_3e3wd"]
radius = 0.150971
height = 1.00097

[sub_resource type="CapsuleShape3D" id="CapsuleShape3D_qe3af"]
radius = 0.0264751
height = 0.264751

[sub_resource type="CapsuleShape3D" id="CapsuleShape3D_udl3d"]
radius = 0.0264751
height = 0.264751

[sub_resource type="CapsuleShape3D" id="CapsuleShape3D_6g66n"]
radius = 0.0274076
height = 0.274076

[sub_resource type="CapsuleShape3D" id="CapsuleShape3D_5r532"]
radius = 0.0274076
height = 0.274076

[sub_resource type="BoxShape3D" id="BoxShape3D_jbm7t"]
size = Vector3(4.30247, 3.06596, 8.25373)

[sub_resource type="CapsuleShape3D" id="CapsuleShape3D_jbm7t"]
radius = 0.371651
height = 1.0496

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_jbm7t"]
animation = &"walk"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_b80u5"]
animation = &"attack"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_j1ijx"]
animation = &"hit"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_vt3n5"]
animation = &"idle"

[sub_resource type="AnimationNodeTimeScale" id="AnimationNodeTimeScale_vt3n5"]

[sub_resource type="AnimationNodeTransition" id="AnimationNodeTransition_7ggby"]
xfade_time = 0.2
input_0/name = "idle"
input_0/auto_advance = false
input_0/break_loop_at_end = false
input_0/reset = true
input_1/name = "walk"
input_1/auto_advance = false
input_1/break_loop_at_end = false
input_1/reset = true
input_2/name = "attack"
input_2/auto_advance = false
input_2/break_loop_at_end = false
input_2/reset = true
input_3/name = "hit"
input_3/auto_advance = false
input_3/break_loop_at_end = false
input_3/reset = true

[sub_resource type="AnimationNodeBlendTree" id="AnimationNodeBlendTree_oun8b"]
graph_offset = Vector2(-41.7799, 239.455)
nodes/Animation/node = SubResource("AnimationNodeAnimation_vt3n5")
nodes/Animation/position = Vector2(660, 140)
"nodes/Animation 2/node" = SubResource("AnimationNodeAnimation_jbm7t")
"nodes/Animation 2/position" = Vector2(460, 340)
"nodes/Animation 3/node" = SubResource("AnimationNodeAnimation_b80u5")
"nodes/Animation 3/position" = Vector2(660, 520)
"nodes/Animation 4/node" = SubResource("AnimationNodeAnimation_j1ijx")
"nodes/Animation 4/position" = Vector2(680, 700)
nodes/TimeScale/node = SubResource("AnimationNodeTimeScale_vt3n5")
nodes/TimeScale/position = Vector2(660, 340)
nodes/Transition/node = SubResource("AnimationNodeTransition_7ggby")
nodes/Transition/position = Vector2(960, 160)
nodes/output/position = Vector2(1180, 140)
node_connections = [&"TimeScale", 0, &"Animation 2", &"Transition", 0, &"Animation", &"Transition", 1, &"TimeScale", &"Transition", 2, &"Animation 3", &"Transition", 3, &"Animation 4", &"output", 0, &"Transition"]

[node name="DogSmall" type="CharacterBody3D" node_paths=PackedStringArray("animation_tree", "model") groups=["animals"]]
collision_layer = 2
collision_mask = 3
script = ExtResource("1_vt3n5")
animation_tree = NodePath("AnimationTree")
model = NodePath("dogsmall")
entity_stats = ExtResource("2_7ggby")

[node name="HealthBar" parent="." instance=ExtResource("6_j1ijx")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1.23625, 0)

[node name="EnemyBehaviourComponent" parent="." node_paths=PackedStringArray("agent", "model", "animation_tree", "detection_area", "hp_bar", "skeleton_modifier", "hip_bone") instance=ExtResource("2_b80u5")]
agent = NodePath("..")
model = NodePath("../dogsmall")
animation_tree = NodePath("../AnimationTree")
detection_area = NodePath("../dogsmall/DetectionArea")
distance_to_attack = 2.5
antagonist_groups = Array[StringName]([&"player", &"knights"])
hp_bar = NodePath("../HealthBar")
ragdoll_on_death = true
skeleton_modifier = NodePath("../dogsmall/metarig/Skeleton3D/PhysicalBoneSimulator3D")
hip_bone = NodePath("../dogsmall/metarig/Skeleton3D/PhysicalBoneSimulator3D/Physical Bone spine_004")

[node name="ActivateDamageArea" parent="." node_paths=PackedStringArray("attaker", "damage_area", "animation_tree") instance=ExtResource("4_oun8b")]
attaker = NodePath("..")
damage_area = NodePath("../dogsmall/metarig/Skeleton3D/BoneAttachment3D/DamageArea")
animation_tree = NodePath("../AnimationTree")
attack_animation_name = &"attack"

[node name="dogsmall" parent="." instance=ExtResource("1_jbm7t")]

[node name="Skeleton3D" parent="dogsmall/metarig" index="0"]
bones/1/position = Vector3(1.169e-09, -0.4085, 0.779428)
bones/8/rotation = Quaternion(-0.080074, -7.07365e-17, -5.70402e-16, 0.996789)
bones/9/rotation = Quaternion(-0.00108243, -2.43463e-17, -4.51151e-16, 0.999999)
bones/10/rotation = Quaternion(-0.0788223, -1.202e-17, -1.50663e-16, 0.996889)
bones/11/rotation = Quaternion(-0.000709891, -5.36413e-20, -7.55885e-17, 1)
bones/12/rotation = Quaternion(-0.10782, 7.32661e-15, 4.09286e-15, 0.99417)
bones/14/rotation = Quaternion(0.442226, 2.13839e-07, 1.05435e-07, 0.896904)
bones/16/rotation = Quaternion(0.41233, -0.00178578, 0.179255, 0.893224)
bones/17/rotation = Quaternion(-0.210519, -0.0140017, 0.0341912, 0.976891)
bones/18/rotation = Quaternion(-0.185091, 0.0250199, -0.012701, 0.982321)
bones/19/rotation = Quaternion(0.00959003, 0.93291, -0.359949, -0.00495904)
bones/20/rotation = Quaternion(0.235813, 1.29968e-07, 9.24963e-07, 0.971799)
bones/22/rotation = Quaternion(0.41233, 0.00178578, -0.179255, 0.893224)
bones/23/rotation = Quaternion(-0.210519, 0.0140017, -0.0341912, 0.976891)
bones/24/rotation = Quaternion(-0.185091, -0.0250199, 0.012701, 0.982321)
bones/25/rotation = Quaternion(-0.00959003, 0.93291, -0.359949, 0.00495904)
bones/26/rotation = Quaternion(0.235813, -1.29968e-07, -9.24963e-07, 0.971799)
bones/27/rotation = Quaternion(0.421399, 0.701399, -0.448317, -0.359826)
bones/29/rotation = Quaternion(0.549697, 0.000463326, -0.000605186, 0.835364)
bones/30/rotation = Quaternion(0.508403, -0.0101955, 0.0208609, 0.860806)
bones/31/rotation = Quaternion(-0.526072, 0.0138882, -0.0146028, 0.850201)
bones/32/rotation = Quaternion(0.00545237, 0.914983, -0.403446, -0.00275675)
bones/33/rotation = Quaternion(0.207539, -8.86044e-08, 1.46648e-06, 0.978227)
bones/34/rotation = Quaternion(0.549697, -0.00046332, 0.000605182, 0.835364)
bones/35/rotation = Quaternion(0.508403, 0.0101955, -0.0208609, 0.860806)
bones/36/rotation = Quaternion(-0.526072, -0.0138882, 0.0146028, 0.850201)
bones/37/rotation = Quaternion(-0.00545229, 0.914983, -0.403446, 0.00275685)
bones/38/rotation = Quaternion(0.207539, 1.2408e-07, -1.63369e-06, 0.978227)
bones/39/position = Vector3(-7.6353e-09, 0.897248, -0.0873376)
bones/39/rotation = Quaternion(-0.265511, 4.21425e-08, 1.16059e-08, 0.964108)
bones/42/position = Vector3(-0.1088, 0.222718, -9.9476e-14)
bones/44/rotation = Quaternion(-1.70449e-06, 0.971798, 0.235816, -7.33688e-08)
bones/46/position = Vector3(-0.1088, 0.222718, 0)
bones/47/position = Vector3(0.1088, 0.222718, -9.9476e-14)
bones/48/position = Vector3(-7.11507e-19, 0.163251, -4.9738e-14)
bones/51/position = Vector3(0.1088, 0.222718, 0)
bones/53/rotation = Quaternion(-7.15256e-06, -6.93335e-31, 1, 9.69352e-26)
bones/54/rotation = Quaternion(-1.50013e-06, 0.978226, 0.207543, -7.38535e-08)
bones/55/rotation = Quaternion(1, 1.20466e-11, 7.22806e-06, -1.63913e-06)
bones/58/position = Vector3(-1.92668e-09, 0.163657, 2.44388e-14)
bones/58/rotation = Quaternion(7.15256e-06, 6.93335e-31, 1, 9.69352e-26)
bones/60/rotation = Quaternion(1, -1.20448e-11, -7.22806e-06, -1.63913e-06)

[node name="BoneAttachment3D" type="BoneAttachment3D" parent="dogsmall/metarig/Skeleton3D" index="14"]
transform = Transform3D(1, -4.27904e-14, 4.76837e-07, 4.42948e-07, -0.37026, -0.928928, 1.76554e-07, 0.928928, -0.37026, -1.169e-09, 0.867384, 0.579511)
bone_name = "mouthbottom"
bone_idx = 14

[node name="DamageArea" type="Area3D" parent="dogsmall/metarig/Skeleton3D/BoneAttachment3D"]
collision_layer = 0
collision_mask = 2
monitorable = false

[node name="CollisionShape3D" type="CollisionShape3D" parent="dogsmall/metarig/Skeleton3D/BoneAttachment3D/DamageArea"]
transform = Transform3D(1, 1.42109e-14, 2.75051e-11, 1.13687e-13, 1, 0, -1.42109e-14, 0, 1, 0.000732401, 0.137835, -0.0184798)
shape = SubResource("BoxShape3D_7ggby")

[node name="PhysicalBoneSimulator3D" type="PhysicalBoneSimulator3D" parent="dogsmall/metarig/Skeleton3D" index="15"]
active = false

[node name="Physical Bone spine_004" type="PhysicalBone3D" parent="dogsmall/metarig/Skeleton3D/PhysicalBoneSimulator3D"]
transform = Transform3D(1, 6.67662e-13, -8.95993e-08, -8.95993e-08, -0.000599261, -1, -5.4361e-11, 1, -0.000599261, -5.38874e-10, 0.786636, -0.4085)
collision_layer = 4
collision_mask = 5
body_offset = Transform3D(1, 6.6766e-13, -2.17652e-09, -6.67653e-13, 1, 5.82077e-11, 2.17653e-09, 0, 1, 0, 0, 0)
bone_name = "spine.004"

[node name="CollisionShape3D" type="CollisionShape3D" parent="dogsmall/metarig/Skeleton3D/PhysicalBoneSimulator3D/Physical Bone spine_004"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -1.73472e-18, 0.366959, -1.45519e-11)
shape = SubResource("CapsuleShape3D_3e3wd")

[node name="Physical Bone front_thigh_L" type="PhysicalBone3D" parent="dogsmall/metarig/Skeleton3D/PhysicalBoneSimulator3D"]
transform = Transform3D(0.999995, 0.000183489, -0.00328555, 0.00295962, 0.386302, 0.922368, 0.00143846, -0.922373, 0.386299, 0.125211, 0.560796, 0.26433)
collision_layer = 4
collision_mask = 5
joint_type = 3
joint_offset = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0.000128184, -0.000142893, 0.133672)
body_offset = Transform3D(1, -6.37036e-06, -1.151e-06, -1.17469e-06, -0.000708818, -1, 6.39819e-06, 1, -0.000709057, -0.000128031, 0.133672, 0.000237674)
bone_name = "front_thigh.L"
joint_constraints/angular_limit_enabled = true
joint_constraints/angular_limit_upper = 90.0
joint_constraints/angular_limit_lower = 0.0
joint_constraints/angular_limit_bias = 0.3
joint_constraints/angular_limit_softness = 0.9
joint_constraints/angular_limit_relaxation = 1.0

[node name="CollisionShape3D" type="CollisionShape3D" parent="dogsmall/metarig/Skeleton3D/PhysicalBoneSimulator3D/Physical Bone front_thigh_L"]
transform = Transform3D(1, 0, 0, 0, 0, 1, 0, -1, 0, 0, 0, 0)
shape = SubResource("CapsuleShape3D_qe3af")

[node name="Physical Bone front_thigh_R" type="PhysicalBone3D" parent="dogsmall/metarig/Skeleton3D/PhysicalBoneSimulator3D"]
transform = Transform3D(0.999995, -0.000183489, 0.00328555, -0.00295962, 0.386302, 0.922368, -0.00143846, -0.922373, 0.386299, -0.125211, 0.560796, 0.26433)
collision_layer = 4
collision_mask = 5
joint_type = 3
joint_offset = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -0.000128184, -0.000142893, 0.133672)
body_offset = Transform3D(1, 6.37036e-06, 1.151e-06, 1.17469e-06, -0.000708818, -1, -6.39819e-06, 1, -0.000709057, 0.000128031, 0.133672, 0.000237674)
bone_name = "front_thigh.R"
joint_constraints/angular_limit_enabled = true
joint_constraints/angular_limit_upper = 90.0
joint_constraints/angular_limit_lower = 0.0
joint_constraints/angular_limit_bias = 0.3
joint_constraints/angular_limit_softness = 0.9
joint_constraints/angular_limit_relaxation = 1.0

[node name="CollisionShape3D" type="CollisionShape3D" parent="dogsmall/metarig/Skeleton3D/PhysicalBoneSimulator3D/Physical Bone front_thigh_R"]
transform = Transform3D(1, 0, 0, 0, 0, 1, 0, -1, 0, 0, 0, 0)
shape = SubResource("CapsuleShape3D_udl3d")

[node name="Physical Bone thigh_L" type="PhysicalBone3D" parent="dogsmall/metarig/Skeleton3D/PhysicalBoneSimulator3D"]
transform = Transform3D(1, 4.84729e-05, -0.000723115, 0.000709265, -0.270523, 0.962713, -0.000148954, -0.962714, -0.270523, 0.124666, 0.598287, -0.304365)
collision_layer = 4
collision_mask = 5
joint_type = 3
joint_offset = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0.000334536, 3.41993e-05, 0.138627)
body_offset = Transform3D(1, -1.7135e-06, -6.70147e-06, -6.69522e-06, 0.00373766, -0.999993, 1.73863e-06, 0.999993, 0.00373778, -0.000333607, 0.138626, -0.000552356)
bone_name = "thigh.L"
joint_constraints/angular_limit_enabled = true
joint_constraints/angular_limit_upper = 90.0
joint_constraints/angular_limit_lower = 0.0
joint_constraints/angular_limit_bias = 0.3
joint_constraints/angular_limit_softness = 0.9
joint_constraints/angular_limit_relaxation = 1.0

[node name="CollisionShape3D" type="CollisionShape3D" parent="dogsmall/metarig/Skeleton3D/PhysicalBoneSimulator3D/Physical Bone thigh_L"]
transform = Transform3D(1, 0, 0, 0, 0, 1, 0, -1, 0, 0, 0, 0)
shape = SubResource("CapsuleShape3D_6g66n")

[node name="Physical Bone thigh_R" type="PhysicalBone3D" parent="dogsmall/metarig/Skeleton3D/PhysicalBoneSimulator3D"]
transform = Transform3D(1, -4.84096e-05, 0.000722997, -0.000709136, -0.270516, 0.962715, 0.000148978, -0.962715, -0.270516, -0.124785, 0.598442, -0.304493)
collision_layer = 4
collision_mask = 5
joint_type = 3
joint_offset = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -0.000215192, -4.57798e-05, 0.138443)
body_offset = Transform3D(1, 1.76657e-06, 6.59666e-06, 6.59034e-06, 0.0037308, -0.999993, -1.79127e-06, 0.999993, 0.00373092, 0.000214279, 0.138443, -0.000470743)
bone_name = "thigh.R"
joint_constraints/angular_limit_enabled = true
joint_constraints/angular_limit_upper = 90.0
joint_constraints/angular_limit_lower = 0.0
joint_constraints/angular_limit_bias = 0.3
joint_constraints/angular_limit_softness = 0.9
joint_constraints/angular_limit_relaxation = 1.0

[node name="CollisionShape3D" type="CollisionShape3D" parent="dogsmall/metarig/Skeleton3D/PhysicalBoneSimulator3D/Physical Bone thigh_R"]
transform = Transform3D(1, 0, 0, 0, 0, 1, 0, -1, 0, 0, 0, 0)
shape = SubResource("CapsuleShape3D_5r532")

[node name="AnimationPlayer" parent="dogsmall" index="1"]
root_motion_track = NodePath("metarig/Skeleton3D:root")
root_motion_local = false
callback_mode_process = 0

[node name="DetectionArea" type="Area3D" parent="dogsmall"]
collision_layer = 0
collision_mask = 2
monitorable = false

[node name="CollisionShape3D" type="CollisionShape3D" parent="dogsmall/DetectionArea"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0.0184729, 1.59675, 4.95649)
shape = SubResource("BoxShape3D_jbm7t")

[node name="CollisionShape3D" type="CollisionShape3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.510548, 0)
shape = SubResource("CapsuleShape3D_jbm7t")

[node name="AnimationTree" type="AnimationTree" parent="."]
root_node = NodePath("../dogsmall")
root_motion_track = NodePath("metarig/Skeleton3D:root")
root_motion_local = false
callback_mode_process = 0
tree_root = SubResource("AnimationNodeBlendTree_oun8b")
anim_player = NodePath("../dogsmall/AnimationPlayer")
parameters/TimeScale/scale = 2.0
parameters/Transition/current_state = "idle"
parameters/Transition/transition_request = ""
parameters/Transition/current_index = 0

[node name="RootMotionView" type="RootMotionView" parent="."]
animation_path = NodePath("../dogsmall/AnimationPlayer")

[editable path="dogsmall"]
