[gd_scene load_steps=27 format=3 uid="uid://cjca6mx3264lj"]

[ext_resource type="PackedScene" uid="uid://bjrdo414yrqyh" path="res://assets/models/chessinggame.glb" id="1_3vyb7"]
[ext_resource type="Script" uid="uid://dgkrnefdt5vfk" path="res://scripts/player.gd" id="1_tuyoq"]
[ext_resource type="Resource" uid="uid://ci82udr0fiuxp" path="res://resources/enemies/player.tres" id="2_d2wvv"]
[ext_resource type="Script" uid="uid://dqlji11317nbq" path="res://scripts/resources/item.gd" id="2_y4r1p"]
[ext_resource type="Resource" uid="uid://dh66upo5w26a" path="res://resources/items/branch.tres" id="3_d2wvv"]
[ext_resource type="Script" uid="uid://dxg0yepbv63k0" path="res://addons/godot_state_charts/state_chart.gd" id="3_fjrip"]
[ext_resource type="Resource" uid="uid://t3iiak64ogdp" path="res://resources/items/pew.tres" id="4_3v2ag"]
[ext_resource type="Script" uid="uid://cwxxkh1jh6pp4" path="res://addons/godot_state_charts/compound_state.gd" id="4_smehm"]
[ext_resource type="Resource" uid="uid://dbi8ijwjyydfa" path="res://resources/items/trap.tres" id="5_jej6c"]
[ext_resource type="Script" uid="uid://bitddddrhbl0d" path="res://addons/godot_state_charts/atomic_state.gd" id="5_ur7pv"]
[ext_resource type="Script" uid="uid://knk6whqnftyj" path="res://addons/godot_state_charts/transition.gd" id="6_y4r1p"]

[sub_resource type="CapsuleShape3D" id="CapsuleShape3D_d2wvv"]
radius = 0.237208
height = 0.633038

[sub_resource type="CapsuleShape3D" id="CapsuleShape3D_3v2ag"]
radius = 0.0446811
height = 0.446811

[sub_resource type="CapsuleShape3D" id="CapsuleShape3D_jej6c"]
radius = 0.0446811
height = 0.446811

[sub_resource type="CapsuleShape3D" id="CapsuleShape3D_g2els"]
height = 2.38132

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_tuyoq"]
animation = &"run"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_smehm"]
animation = &"jump"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_ur7pv"]
animation = &"fall"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_y4r1p"]
animation = &"cast"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_fjrip"]
animation = &"idle"

[sub_resource type="AnimationNodeTimeScale" id="AnimationNodeTimeScale_tuyoq"]

[sub_resource type="AnimationNodeTransition" id="AnimationNodeTransition_smehm"]
xfade_time = 0.2
input_0/name = "idle"
input_0/auto_advance = false
input_0/break_loop_at_end = false
input_0/reset = true
input_1/name = "run"
input_1/auto_advance = false
input_1/break_loop_at_end = false
input_1/reset = true
input_2/name = "jump"
input_2/auto_advance = false
input_2/break_loop_at_end = false
input_2/reset = true
input_3/name = "fall"
input_3/auto_advance = false
input_3/break_loop_at_end = false
input_3/reset = true
input_4/name = "cast"
input_4/auto_advance = false
input_4/break_loop_at_end = false
input_4/reset = true

[sub_resource type="AnimationNodeBlendTree" id="AnimationNodeBlendTree_tuyoq"]
graph_offset = Vector2(-250.086, 71.4002)
nodes/Animation/node = SubResource("AnimationNodeAnimation_fjrip")
nodes/Animation/position = Vector2(60, 20)
"nodes/Animation 2/node" = SubResource("AnimationNodeAnimation_tuyoq")
"nodes/Animation 2/position" = Vector2(-80, 220)
"nodes/Animation 3/node" = SubResource("AnimationNodeAnimation_smehm")
"nodes/Animation 3/position" = Vector2(120, 340)
"nodes/Animation 4/node" = SubResource("AnimationNodeAnimation_ur7pv")
"nodes/Animation 4/position" = Vector2(40, 520)
"nodes/Animation 5/node" = SubResource("AnimationNodeAnimation_y4r1p")
"nodes/Animation 5/position" = Vector2(428.191, 599.256)
nodes/TimeScale/node = SubResource("AnimationNodeTimeScale_tuyoq")
nodes/TimeScale/position = Vector2(180, 160)
nodes/Transition/node = SubResource("AnimationNodeTransition_smehm")
nodes/Transition/position = Vector2(540, 60)
nodes/output/position = Vector2(760, 120)
node_connections = [&"TimeScale", 0, &"Animation 2", &"Transition", 0, &"Animation", &"Transition", 1, &"TimeScale", &"Transition", 2, &"Animation 3", &"Transition", 3, &"Animation 4", &"Transition", 4, &"Animation 5", &"output", 0, &"Transition"]

[sub_resource type="Animation" id="Animation_fjrip"]
length = 0.001
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Yaw/Pitch/Camera3D:h_offset")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [0.0]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("Yaw/Pitch:spring_length")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [10.0]
}

[sub_resource type="Animation" id="Animation_tuyoq"]
resource_name = "zoom_in"
length = 0.2
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Yaw/Pitch/Camera3D:h_offset")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.2),
"transitions": PackedFloat32Array(1, 1),
"update": 0,
"values": [0.0, 4.885]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("Yaw/Pitch:spring_length")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0, 0.2),
"transitions": PackedFloat32Array(1, 1),
"update": 0,
"values": [10.0, 5.0]
}

[sub_resource type="AnimationLibrary" id="AnimationLibrary_smehm"]
_data = {
&"RESET": SubResource("Animation_fjrip"),
&"zoom_in": SubResource("Animation_tuyoq")
}

[node name="Player" type="CharacterBody3D" node_paths=PackedStringArray("hip_bone", "skeleton_modifier") groups=["player"]]
collision_layer = 2
collision_mask = 3
script = ExtResource("1_tuyoq")
clamp_pitch_rotation = 70.0
antagonist_groups = Array[StringName]([&"animals", &"knights"])
stats = ExtResource("2_d2wvv")
hip_bone = NodePath("chessinggame/Armature_001/Skeleton3D/PhysicalBoneSimulator3D/Physical Bone hips")
skeleton_modifier = NodePath("chessinggame/Armature_001/Skeleton3D/PhysicalBoneSimulator3D")
item_amounts = Dictionary[ExtResource("2_y4r1p"), int]({
ExtResource("3_d2wvv"): 2,
ExtResource("4_3v2ag"): 3,
ExtResource("5_jej6c"): 4
})

[node name="Yaw" type="Node3D" parent="."]
unique_name_in_owner = true

[node name="Pitch" type="SpringArm3D" parent="Yaw"]
unique_name_in_owner = true
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 2.23415, 0)
spring_length = 10.0

[node name="Camera3D" type="Camera3D" parent="Yaw/Pitch"]
unique_name_in_owner = true
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.53279, 4.40783)

[node name="ShootFrom" type="Marker3D" parent="Yaw"]
unique_name_in_owner = true
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0.569077, 1.56689, -1.51667)

[node name="chessinggame" parent="." instance=ExtResource("1_3vyb7")]
transform = Transform3D(-1, 0, -8.74228e-08, 0, 1, 0, 8.74228e-08, 0, -1, 0, 0, 0)

[node name="Skeleton3D" parent="chessinggame/Armature_001" index="0"]
bones/7/position = Vector3(0, 0, 1.08826)
bones/7/rotation = Quaternion(3.09086e-08, 0.707107, 0.707107, 3.09086e-08)
bones/13/rotation = Quaternion(0.0220125, 0.434717, -0.06845, 0.897692)
bones/14/rotation = Quaternion(0.411066, 1.72524e-08, 1.52854e-07, 0.911606)
bones/17/rotation = Quaternion(0.0320414, -0.463594, 0.107068, 0.878971)
bones/18/rotation = Quaternion(0.331471, 1.58489e-08, -1.02186e-07, 0.943466)
bones/20/rotation = Quaternion(-5.33605e-08, 0.0271887, 0.99963, 9.31247e-08)
bones/21/rotation = Quaternion(-0.050857, -6.7134e-09, 1.13635e-07, 0.998706)
bones/22/rotation = Quaternion(0.475472, -2.68607e-07, -7.01707e-08, 0.879731)
bones/24/rotation = Quaternion(6.92597e-08, 0.0271887, 0.99963, -9.35571e-08)
bones/25/rotation = Quaternion(-0.050857, 6.71341e-09, -1.13635e-07, 0.998706)
bones/26/rotation = Quaternion(0.475472, 2.82942e-07, 6.32794e-08, 0.879731)
bones/27/rotation = Quaternion(0.308471, 4.15797e-08, 1.33607e-07, 0.951234)
bones/28/position = Vector3(0.961641, -0.184145, 0.267276)
bones/30/position = Vector3(-0.976214, -0.246263, 0.171608)
bones/31/position = Vector3(-0.957383, 0.731472, -0.309752)

[node name="PhysicalBoneSimulator3D" type="PhysicalBoneSimulator3D" parent="chessinggame/Armature_001/Skeleton3D" index="9"]

[node name="Physical Bone hips" type="PhysicalBone3D" parent="chessinggame/Armature_001/Skeleton3D/PhysicalBoneSimulator3D"]
transform = Transform3D(1, -7.10543e-15, 0, 0, 0, -1, 7.10543e-15, 1, 0, 0, 1.3115, 0)
collision_layer = 4
collision_mask = 5
joint_type = 3
joint_offset = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0.223239)
body_offset = Transform3D(1, 0, 0, 0, 0, -1, 0, 1, 0, 0, 0.223239, 0)
bone_name = "hips"
joint_constraints/angular_limit_enabled = false
joint_constraints/angular_limit_upper = 90.0
joint_constraints/angular_limit_lower = -90.0
joint_constraints/angular_limit_bias = 0.3
joint_constraints/angular_limit_softness = 0.9
joint_constraints/angular_limit_relaxation = 1.0

[node name="CollisionShape3D" type="CollisionShape3D" parent="chessinggame/Armature_001/Skeleton3D/PhysicalBoneSimulator3D/Physical Bone hips"]
transform = Transform3D(1, 0, 0, 0, 0, 1, 0, -1, 0, 0, 0, -0.0155545)
shape = SubResource("CapsuleShape3D_d2wvv")

[node name="Physical Bone leg1_L" type="PhysicalBone3D" parent="chessinggame/Armature_001/Skeleton3D/PhysicalBoneSimulator3D"]
transform = Transform3D(-1, -1.01343e-07, 1.78838e-07, 1.73033e-07, 0.0546472, 0.998506, -1.10965e-07, 0.998506, -0.0546472, 0.199841, 0.872759, 0.0100284)
collision_layer = 4
collision_mask = 5
joint_type = 3
joint_offset = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -0.00308456, 0.00153437, 0.211549)
body_offset = Transform3D(1, -2.19265e-10, 1.02735e-08, 1.02734e-08, -0.000290316, -1, 2.22247e-10, 1, -0.000290316, 0.00308456, 0.211549, -0.00147295)
bone_name = "leg1.L"
joint_constraints/angular_limit_enabled = false
joint_constraints/angular_limit_upper = 90.0
joint_constraints/angular_limit_lower = -90.0
joint_constraints/angular_limit_bias = 0.3
joint_constraints/angular_limit_softness = 0.9
joint_constraints/angular_limit_relaxation = 1.0

[node name="CollisionShape3D" type="CollisionShape3D" parent="chessinggame/Armature_001/Skeleton3D/PhysicalBoneSimulator3D/Physical Bone leg1_L"]
transform = Transform3D(1, 0, 0, 0, 0, 1, 0, -1, 0, 0, 0, 0)
shape = SubResource("CapsuleShape3D_3v2ag")

[node name="Physical Bone leg1_R" type="PhysicalBone3D" parent="chessinggame/Armature_001/Skeleton3D/PhysicalBoneSimulator3D"]
transform = Transform3D(-1, 1.31161e-07, -1.80903e-07, -1.73465e-07, 0.0546472, 0.998506, 1.40851e-07, 0.998506, -0.0546472, -0.201407, 0.866929, 0.0144777)
collision_layer = 4
collision_mask = 5
joint_type = 3
joint_offset = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0.00151845, -0.00258968, 0.217613)
body_offset = Transform3D(1, 2.16464e-09, -9.94695e-09, -9.94633e-09, -0.000290316, -1, -2.16752e-09, 1, -0.000290316, -0.00151844, 0.217612, 0.00265285)
bone_name = "leg1.R"
joint_constraints/angular_limit_enabled = false
joint_constraints/angular_limit_upper = 90.0
joint_constraints/angular_limit_lower = -90.0
joint_constraints/angular_limit_bias = 0.3
joint_constraints/angular_limit_softness = 0.9
joint_constraints/angular_limit_relaxation = 1.0

[node name="CollisionShape3D" type="CollisionShape3D" parent="chessinggame/Armature_001/Skeleton3D/PhysicalBoneSimulator3D/Physical Bone leg1_R"]
transform = Transform3D(1, 0, 0, 0, 0, 1, 0, -1, 0, 0, 0, 0)
shape = SubResource("CapsuleShape3D_jej6c")

[node name="AnimationPlayer" parent="chessinggame" index="1"]
root_motion_track = NodePath("Armature_001/Skeleton3D:root")
root_motion_local = false
callback_mode_process = 0

[node name="CollisionShape3D" type="CollisionShape3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1.21644, 0)
shape = SubResource("CapsuleShape3D_g2els")

[node name="RootMotionView" type="RootMotionView" parent="."]
animation_path = NodePath("../chessinggame/AnimationPlayer")
radius = 9.95

[node name="StateChart" type="Node" parent="."]
unique_name_in_owner = true
script = ExtResource("3_fjrip")
metadata/_custom_type_script = "uid://dxg0yepbv63k0"

[node name="CompoundState" type="Node" parent="StateChart"]
script = ExtResource("4_smehm")
initial_state = NodePath("FreeCamera")
metadata/_custom_type_script = "uid://cwxxkh1jh6pp4"

[node name="FreeCamera" type="Node" parent="StateChart/CompoundState"]
script = ExtResource("4_smehm")
initial_state = NodePath("Onground")
metadata/_custom_type_script = "uid://cwxxkh1jh6pp4"

[node name="Onground" type="Node" parent="StateChart/CompoundState/FreeCamera"]
script = ExtResource("4_smehm")
initial_state = NodePath("Idle")

[node name="ToFalling" type="Node" parent="StateChart/CompoundState/FreeCamera/Onground"]
script = ExtResource("6_y4r1p")
to = NodePath("../../Falling")
event = &"falling"
delay_in_seconds = "0.0"

[node name="ToDead" type="Node" parent="StateChart/CompoundState/FreeCamera/Onground"]
script = ExtResource("6_y4r1p")
to = NodePath("../../Dead")
event = &"die"
delay_in_seconds = "0.0"
metadata/_custom_type_script = "uid://knk6whqnftyj"

[node name="Idle" type="Node" parent="StateChart/CompoundState/FreeCamera/Onground"]
script = ExtResource("5_ur7pv")

[node name="ToBallista" type="Node" parent="StateChart/CompoundState/FreeCamera/Onground/Idle"]
script = ExtResource("6_y4r1p")
to = NodePath("../../../../OperatingBallista")
event = &"ballista"
delay_in_seconds = "0.0"
metadata/_custom_type_script = "uid://knk6whqnftyj"

[node name="ToRun" type="Node" parent="StateChart/CompoundState/FreeCamera/Onground/Idle"]
script = ExtResource("6_y4r1p")
to = NodePath("../../Run")
event = &"running"
delay_in_seconds = "0.0"

[node name="ToAiming" type="Node" parent="StateChart/CompoundState/FreeCamera/Onground/Idle"]
script = ExtResource("6_y4r1p")
to = NodePath("../../Aiming")
event = &"aim"
delay_in_seconds = "0.0"
metadata/_custom_type_script = "uid://knk6whqnftyj"

[node name="Run" type="Node" parent="StateChart/CompoundState/FreeCamera/Onground"]
script = ExtResource("5_ur7pv")

[node name="ToIdle" type="Node" parent="StateChart/CompoundState/FreeCamera/Onground/Run"]
script = ExtResource("6_y4r1p")
to = NodePath("../../Idle")
event = &"no_input"
delay_in_seconds = "0.0"

[node name="ToJumping" type="Node" parent="StateChart/CompoundState/FreeCamera/Onground/Run"]
script = ExtResource("6_y4r1p")
to = NodePath("../../Jumping")
event = &"jump"
delay_in_seconds = "0.0"

[node name="Jumping" type="Node" parent="StateChart/CompoundState/FreeCamera/Onground"]
script = ExtResource("5_ur7pv")

[node name="ToRun" type="Node" parent="StateChart/CompoundState/FreeCamera/Onground/Jumping"]
script = ExtResource("6_y4r1p")
to = NodePath("../../Run")
event = &"landed"
delay_in_seconds = "0.7"

[node name="Aiming" type="Node" parent="StateChart/CompoundState/FreeCamera/Onground"]
script = ExtResource("5_ur7pv")
metadata/_custom_type_script = "uid://bitddddrhbl0d"

[node name="ToIdle" type="Node" parent="StateChart/CompoundState/FreeCamera/Onground/Aiming"]
script = ExtResource("6_y4r1p")
to = NodePath("../../Idle")
event = &"stop_aim"
delay_in_seconds = "0.0"
metadata/_custom_type_script = "uid://knk6whqnftyj"

[node name="Falling" type="Node" parent="StateChart/CompoundState/FreeCamera"]
script = ExtResource("5_ur7pv")

[node name="Transition" type="Node" parent="StateChart/CompoundState/FreeCamera/Falling"]
script = ExtResource("6_y4r1p")
to = NodePath("../../Onground")
event = &"landed"
delay_in_seconds = "0.0"

[node name="Dead" type="Node" parent="StateChart/CompoundState/FreeCamera"]
script = ExtResource("5_ur7pv")
metadata/_custom_type_script = "uid://bitddddrhbl0d"

[node name="OperatingBallista" type="Node" parent="StateChart/CompoundState"]
script = ExtResource("5_ur7pv")
metadata/_custom_type_script = "uid://bitddddrhbl0d"

[node name="ToIdle" type="Node" parent="StateChart/CompoundState/OperatingBallista"]
script = ExtResource("6_y4r1p")
to = NodePath("../../FreeCamera/Onground/Idle")
event = &"ballista_exit"
delay_in_seconds = "0.0"
metadata/_custom_type_script = "uid://knk6whqnftyj"

[node name="AnimationTree" type="AnimationTree" parent="."]
unique_name_in_owner = true
root_node = NodePath("%AnimationTree/../chessinggame")
root_motion_track = NodePath("Armature_001/Skeleton3D:root")
root_motion_local = false
callback_mode_process = 0
tree_root = SubResource("AnimationNodeBlendTree_tuyoq")
anim_player = NodePath("../chessinggame/AnimationPlayer")
parameters/TimeScale/scale = 0.5
parameters/Transition/current_state = "idle"
parameters/Transition/transition_request = ""
parameters/Transition/current_index = 0.18332

[node name="CameraAnimation" type="AnimationPlayer" parent="."]
unique_name_in_owner = true
libraries = {
&"": SubResource("AnimationLibrary_smehm")
}

[connection signal="state_unhandled_input" from="StateChart/CompoundState/FreeCamera" to="." method="_on_free_camera_state_unhandled_input"]
[connection signal="state_entered" from="StateChart/CompoundState/FreeCamera/Onground/Idle" to="." method="_on_idle_state_entered"]
[connection signal="state_physics_processing" from="StateChart/CompoundState/FreeCamera/Onground/Idle" to="." method="_on_idle_state_physics_processing"]
[connection signal="state_unhandled_input" from="StateChart/CompoundState/FreeCamera/Onground/Idle" to="." method="_on_idle_state_unhandled_input"]
[connection signal="state_entered" from="StateChart/CompoundState/FreeCamera/Onground/Run" to="." method="_on_run_state_entered"]
[connection signal="state_physics_processing" from="StateChart/CompoundState/FreeCamera/Onground/Run" to="." method="_on_run_state_physics_processing"]
[connection signal="state_entered" from="StateChart/CompoundState/FreeCamera/Onground/Jumping" to="." method="_on_jumping_state_entered"]
[connection signal="state_physics_processing" from="StateChart/CompoundState/FreeCamera/Onground/Jumping" to="." method="_on_jumping_state_physics_processing"]
[connection signal="state_entered" from="StateChart/CompoundState/FreeCamera/Onground/Aiming" to="." method="_on_aiming_state_entered"]
[connection signal="state_exited" from="StateChart/CompoundState/FreeCamera/Onground/Aiming" to="." method="_on_aiming_state_exited"]
[connection signal="state_physics_processing" from="StateChart/CompoundState/FreeCamera/Onground/Aiming" to="." method="_on_aiming_state_physics_processing"]
[connection signal="state_unhandled_input" from="StateChart/CompoundState/FreeCamera/Onground/Aiming" to="." method="_on_aiming_state_unhandled_input"]
[connection signal="state_entered" from="StateChart/CompoundState/FreeCamera/Falling" to="." method="_on_falling_state_entered"]
[connection signal="state_physics_processing" from="StateChart/CompoundState/FreeCamera/Falling" to="." method="_on_falling_state_physics_processing"]
[connection signal="state_entered" from="StateChart/CompoundState/FreeCamera/Dead" to="." method="_on_dead_state_entered"]
[connection signal="state_entered" from="StateChart/CompoundState/OperatingBallista" to="." method="_on_operating_ballista_state_entered"]
[connection signal="state_exited" from="StateChart/CompoundState/OperatingBallista" to="." method="_on_operating_ballista_state_exited"]
[connection signal="state_unhandled_input" from="StateChart/CompoundState/OperatingBallista" to="." method="_on_operating_ballista_state_unhandled_input"]

[editable path="chessinggame"]
